<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to enable firmware management on child devices - thin-edge.io docs</title>
        <!-- Custom HTML head -->
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../././mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/pagetoc.css">
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item "><a href="../../start/index.html"><strong aria-hidden="true">2.</strong> Getting started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../start/getting-started.html"><strong aria-hidden="true">2.1.</strong> Getting started</a></li><li class="chapter-item "><a href="../../start/connect-c8y.html"><strong aria-hidden="true">2.2.</strong> Connect my device to Cumulocity IoT</a></li><li class="chapter-item "><a href="../../start/connect-azure.html"><strong aria-hidden="true">2.3.</strong> Connect my device to Azure IoT</a></li><li class="chapter-item "><a href="../../start/connect-aws.html"><strong aria-hidden="true">2.4.</strong> Connect my device to AWS IoT</a></li><li class="chapter-item "><a href="../../start/send-thin-edge-data.html"><strong aria-hidden="true">2.5.</strong> Send measurements</a></li><li class="chapter-item "><a href="../../start/raise-alarm.html"><strong aria-hidden="true">2.6.</strong> Raise alarms</a></li><li class="chapter-item "><a href="../../start/send-events.html"><strong aria-hidden="true">2.7.</strong> Send events</a></li><li class="chapter-item "><a href="../../start/device-monitoring.html"><strong aria-hidden="true">2.8.</strong> Monitor my device</a></li><li class="chapter-item "><a href="../../start/software-management.html"><strong aria-hidden="true">2.9.</strong> Manage my device software</a></li></ol></li><li class="chapter-item "><a href="../../understand/index.html"><strong aria-hidden="true">3.</strong> Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../understand/faq.html"><strong aria-hidden="true">3.1.</strong> Architecture FAQ</a></li><li class="chapter-item "><a href="../../understand/thin-edge-json.html"><strong aria-hidden="true">3.2.</strong> Thin Edge Json</a></li><li class="chapter-item "><a href="../../understand/mapper.html"><strong aria-hidden="true">3.3.</strong> The Mapper</a></li><li class="chapter-item "><a href="../../understand/software-management.html"><strong aria-hidden="true">3.4.</strong> Software Management</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/index.html"><strong aria-hidden="true">4.</strong> Operate devices</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/index.html"><strong aria-hidden="true">4.1.</strong> Installation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/installation.html"><strong aria-hidden="true">4.1.1.</strong> How to install thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/installation/installation_without_deb_support.html"><strong aria-hidden="true">4.1.2.</strong> How to install thin-edge.io on any Linux OS (no deb support)?</a></li><li class="chapter-item "><a href="../../operate/installation/how_to_install_thin_edge_manually.html"><strong aria-hidden="true">4.1.3.</strong> How to install thin-edge manually with openrc</a></li><li class="chapter-item "><a href="../../operate/installation/install_and_enable_software_management.html"><strong aria-hidden="true">4.1.4.</strong> How to install and enable software management?</a></li></ol></li><li class="chapter-item "><a href="../../operate/configuration/index.html"><strong aria-hidden="true">4.2.</strong> Configuration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/configuration/config.html"><strong aria-hidden="true">4.2.1.</strong> How to configure thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/configuration/config_local_mqtt_bind_address_and_port.html"><strong aria-hidden="true">4.2.2.</strong> How to configure the local mqtt bind address and port?</a></li><li class="chapter-item "><a href="../../operate/configuration/how_to_use_preferred_init_system.html"><strong aria-hidden="true">4.2.3.</strong> How to use thin-edge.io with your preferred init system</a></li><li class="chapter-item "><a href="../../operate/configuration/update_config_paths.html"><strong aria-hidden="true">4.2.4.</strong> How to change temp path?</a></li><li class="chapter-item "><a href="../../operate/configuration/child-device-config-management.html"><strong aria-hidden="true">4.2.5.</strong> Configuration management on child-devices</a></li></ol></li><li class="chapter-item "><a href="../../operate/security/index.html"><strong aria-hidden="true">4.3.</strong> Security and Access Control</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/security/registration.html"><strong aria-hidden="true">4.3.1.</strong> How to create a test certificate?</a></li><li class="chapter-item "><a href="../../operate/security/add_self_signed_trusted.html"><strong aria-hidden="true">4.3.2.</strong> How to add self-signed certificate root to trusted certificates list?</a></li><li class="chapter-item "><a href="../../operate/security/mqtt_local_broker_authentication.html"><strong aria-hidden="true">4.3.3.</strong> How to set up client/server authentication for the local MQTT broker</a></li></ol></li><li class="chapter-item "><a href="../../operate/connection/index.html"><strong aria-hidden="true">4.4.</strong> Connection to cloud</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/connection/connect.html"><strong aria-hidden="true">4.4.1.</strong> How to connect cloud end-point?</a></li></ol></li><li class="chapter-item "><a href="../../operate/telemetry/index.html"><strong aria-hidden="true">4.5.</strong> Processing Telemetry Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/telemetry/pub_sub.html"><strong aria-hidden="true">4.5.1.</strong> How to use tedge mqtt?</a></li></ol></li><li class="chapter-item "><a href="../../operate/operations/index.html"><strong aria-hidden="true">4.6.</strong> Operations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/operations/restart_device_operation.html"><strong aria-hidden="true">4.6.1.</strong> How to restart your thin-edge.io device</a></li></ol></li><li class="chapter-item "><a href="../../operate/monitoring/index.html"><strong aria-hidden="true">4.7.</strong> Monitoring</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/monitoring/enable_tedge_watchdog_using_systemd.html"><strong aria-hidden="true">4.7.1.</strong> How to enable watchdog using systemd?</a></li><li class="chapter-item "><a href="../../operate/monitoring/connect_external_device.html"><strong aria-hidden="true">4.7.2.</strong> How to connect an external device?</a></li></ol></li><li class="chapter-item "><a href="../../operate/troubleshooting/index.html"><strong aria-hidden="true">4.8.</strong> Troubleshooting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/troubleshooting/test_connection.html"><strong aria-hidden="true">4.8.1.</strong> How to test the cloud connection?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/thin_edge_logs.html"><strong aria-hidden="true">4.8.2.</strong> How to access the logs on the device?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/monitor_tedge_health.html"><strong aria-hidden="true">4.8.3.</strong> How to monitor health of tedge daemons</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/trouble_shooting_monitoring.html"><strong aria-hidden="true">4.8.4.</strong> How to trouble shoot device monitoring?</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/c8y/index.html"><strong aria-hidden="true">4.9.</strong> Device Management with Cumulocity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/c8y/supported_operations.html"><strong aria-hidden="true">4.9.1.</strong> Supported Operations Management for Cumulocity IoT</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_fragments.html"><strong aria-hidden="true">4.9.2.</strong> How to add custom fragments to Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_log_plugin.html"><strong aria-hidden="true">4.9.3.</strong> How to retrieve logs with the log plugin</a></li><li class="chapter-item "><a href="../../operate/c8y/smartrest_templates.html"><strong aria-hidden="true">4.9.4.</strong> How to add C8Y SmartRest Templates</a></li><li class="chapter-item "><a href="../../operate/c8y/config_management_plugin.html"><strong aria-hidden="true">4.9.5.</strong> How to manage configuration files with Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/child_device_config_management_agent.html"><strong aria-hidden="true">4.9.6.</strong> How to enable configuration management on child devices</a></li><li class="chapter-item expanded "><a href="../../operate/c8y/child_device_firmware_management.html" class="active"><strong aria-hidden="true">4.9.7.</strong> How to enable firmware management on child devices</a></li><li class="chapter-item "><a href="../../operate/c8y/remote_access_with_cumulocity.html"><strong aria-hidden="true">4.9.8.</strong> How to remotely connect to your thin-edge.io device via SSH/VNC/Telnet with Cumulocity remote access</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_service_monitoring.html"><strong aria-hidden="true">4.9.9.</strong> How to monitor a service from Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/apama_software_management_plugin.html"><strong aria-hidden="true">4.9.10.</strong> How to manage Apama software artifacts with Apama plugin?</a></li><li class="chapter-item "><a href="../../operate/c8y/retrieve_jwt_token_from_cumulocity.html"><strong aria-hidden="true">4.9.11.</strong> How to retrieve JWT token from Cumulocity?</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../extend/index.html"><strong aria-hidden="true">5.</strong> Extend thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extend/write-my-software-management-plugin.html"><strong aria-hidden="true">5.1.</strong> Write my software management plugin</a></li><li class="chapter-item "><a href="../../extend/yocto-linux.html"><strong aria-hidden="true">5.2.</strong> Build Thin Edge for a Yocto Linux distribution</a></li></ol></li><li class="chapter-item "><a href="../../contribute/index.html"><strong aria-hidden="true">6.</strong> Contribute to thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../contribute/BUILDING.html"><strong aria-hidden="true">6.1.</strong> Building</a></li><li class="chapter-item "><a href="../../contribute/DEV_CONTAINER.html"><strong aria-hidden="true">6.2.</strong> Using a dev container</a></li><li class="chapter-item "><a href="../../contribute/DEBIAN_PACKAGE_HOSTING.html"><strong aria-hidden="true">6.3.</strong> Debian package hosting</a></li><li class="chapter-item "><a href="../../contribute/INSTALLING_DOCKER.html"><strong aria-hidden="true">6.4.</strong> Installing Docker</a></li></ol></li><li class="chapter-item "><a href="../../references/index.html"><strong aria-hidden="true">7.</strong> Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/supported-platforms.html"><strong aria-hidden="true">7.1.</strong> Supported platforms</a></li><li class="chapter-item "><a href="../../references/thin-edge-config-files.html"><strong aria-hidden="true">7.2.</strong> Thin-edge.io configuration files</a></li><li class="chapter-item "><a href="../../references/bridged-topics.html"><strong aria-hidden="true">7.3.</strong> MQTT bridge configuration</a></li><li class="chapter-item "><a href="../../references/init-system-config.html"><strong aria-hidden="true">7.4.</strong> Init System Configuration File</a></li><li class="chapter-item "><a href="../../references/tedge.html"><strong aria-hidden="true">7.5.</strong> tedge command</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/tedge-cert.html"><strong aria-hidden="true">7.5.1.</strong> tedge cert command</a></li><li class="chapter-item "><a href="../../references/tedge-config.html"><strong aria-hidden="true">7.5.2.</strong> tedge config command</a></li><li class="chapter-item "><a href="../../references/tedge-connect.html"><strong aria-hidden="true">7.5.3.</strong> tedge connect command</a></li><li class="chapter-item "><a href="../../references/tedge-disconnect.html"><strong aria-hidden="true">7.5.4.</strong> tedge disconnect command</a></li><li class="chapter-item "><a href="../../references/tedge-mqtt.html"><strong aria-hidden="true">7.5.5.</strong> tedge mqtt command</a></li></ol></li><li class="chapter-item "><a href="../../understand/domain-model.html"><strong aria-hidden="true">7.6.</strong> Domain Model</a></li><li class="chapter-item "><a href="../../understand/data-model.html"><strong aria-hidden="true">7.7.</strong> Data Model</a></li><li class="chapter-item "><a href="../../references/plugin-api.html"><strong aria-hidden="true">7.8.</strong> Plugin API</a></li><li class="chapter-item "><a href="../../references/c8y-log-management.html"><strong aria-hidden="true">7.9.</strong> Log Management</a></li><li class="chapter-item "><a href="../../references/c8y-configuration-management.html"><strong aria-hidden="true">7.10.</strong> Configuration Management</a></li><li class="chapter-item "><a href="../../references/c8y-firmware-management.html"><strong aria-hidden="true">7.11.</strong> Firmware Management</a></li><li class="chapter-item "><a href="../../references/tedge-file-transfer-service.html"><strong aria-hidden="true">7.12.</strong> Thin Edge File Transfer Service</a></li></ol></li><li class="chapter-item "><a href="../../SUMMARY.html"><strong aria-hidden="true">8.</strong> Index</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">thin-edge.io docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <h1 id="enable-firmware-management-on-child-devices-with-cumulocity"><a class="header" href="#enable-firmware-management-on-child-devices-with-cumulocity">Enable firmware management on child devices with Cumulocity</a></h1>
<p>Firmware management can be enabled for child devices using the <code>c8y-firmware-plugin</code>.
This thin-edge plugin coordinates the firmware update operation handling with Cumulocity,
by establishing secure communication with the cloud,
managing firmware file downloads, which are typically large files, even over flaky networks,
caching the downloaded files for re-use across multiple child devices etc.
For more details on the inner workings of this plugin, refer to the <a href="../../references/c8y-firmware-management.html">reference guide</a>.</p>
<p>In order to install the firmware itself on the child device,
an additional piece of software must be developed by the child device owner as well,
to coordinate firmware installation on the device with the <code>c8y-firmware-plugin</code> running on thin-edge.
This software is referred to as <code>child-device-connector</code> in the rest of this document.</p>
<p>The responsibilities of the child device connector are:</p>
<ul>
<li>Receive firmware update requests from thin-edge</li>
<li>Download and apply the updated firmware from thin-edge</li>
<li>Send status updates on the progress of the firmware update operation to thin-edge</li>
</ul>
<p>Handling the above mentioned responsibilities involves
multiple interactions with thin-edge over its MQTT and HTTP APIs.
In cases where the child device connector is installed alongside thin-edge on the same device,
these APIs can be accessed via a local IP or even <code>127.0.0.1</code>.
The MQTT APIs are exposed via port 1883 and the HTTP APIs are exposed via port 8000, by default.
When the child device connector is running directly on the external child device,
the MQTT and HTTP APIs of thin-edge need to be accessed over the network using its IP address and ports,
which are configured using the tedge config settings <code>mqtt.client.host</code> or <code>mqtt.client.port</code> for MQTT
and <code>http.address</code> and <code>http.port</code> for HTTP.</p>
<p>The <code>c8y-firmware-plugin</code> running on thin-edge, along with the <code>child-device-connector</code>
running either on the thin-edge device itself or directly on the child device,
provides firmware management support for that device.</p>
<h2 id="declare-firmware-management-support-of-child-device"><a class="header" href="#declare-firmware-management-support-of-child-device">Declare firmware management support of child device</a></h2>
<p>At first, the child device needs to declare that it supports firmware management from Cumulocity
using the <a href="supported_operations.html">supported operations API</a> of thin-edge
by simply creating an empty operations file on the thin-edge device as follows:</p>
<pre><code class="language-shell">touch /etc/tedge/operations/c8y/&lt;child-device-id&gt;/c8y_Firmware
</code></pre>
<p>This action will add <code>c8y_Firmware</code> as a new supported operation for the child device in Cumulocity.</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note"></a></p>
</div>
<div>
<p>This initial bootstrapping step needs to be performed on the thin-edge device directly
and can not be done from the child device over the network.
An over-the-network API for the same could be provided in future releases.</p>
</div>
</div>
<h1 id="handle-firmware-update-requests-from-thin-edge"><a class="header" href="#handle-firmware-update-requests-from-thin-edge">Handle firmware update requests from thin-edge</a></h1>
<p>Once the firmware management operation is enabled for a child device,
it is ready to serve firmware update requests received from Cumulocity via thin-edge.</p>
<p>Handling firmware update requests from thin-edge is a 5-step process:</p>
<ol>
<li>Subscribe to, and receive firmware update requests via MQTT</li>
<li>Send an &quot;executing&quot; operation status update to acknowledge the receipt of the request via MQTT</li>
<li>Download the firmware file update from the URL received in the request via HTTP</li>
<li>Apply the firmware file update on the child device</li>
<li>Send a &quot;successful&quot; operation status update via MQTT</li>
</ol>
<p>The following sections cover these steps in detail.</p>
<h3 id="subscribe-to-firmware-update-requests-via-mqtt"><a class="header" href="#subscribe-to-firmware-update-requests-via-mqtt">Subscribe to firmware update requests via MQTT</a></h3>
<p>The child device connector must subscribe to the <code>tedge/{CHILD_ID}/commands/req/firmware_update</code> MQTT topic
to receive the firmware update requests from thin-edge.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-shell">mosquitto_sub -h {TEDGE_DEVICE_IP} -t &quot;tedge/{CHILD_ID}/commands/req/firmware_update&quot;
</code></pre>
<p>These requests arrive in the following JSON format:</p>
<p><strong>Payload:</strong></p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;{OP_ID}&quot;,
    &quot;attempt&quot;: 1,
    &quot;name&quot;: &quot;{FIRMWARE_NAME}&quot;,
    &quot;version&quot;: &quot;{FIRMWARE_VERSION}&quot;,
    &quot;url&quot;:&quot;http://{TEDGE_HTTP_ADDRESS}:{TEDGE_HTTP_PORT}/tedge/file-transfer/tedge-child/firmware_update/{FILE_ID}&quot;,
    &quot;sha256&quot;:&quot;{FIRMWARE_FILE_SHA256}&quot;
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;tLrLthPXksKbqRqIsrDmy&quot;,
    &quot;attempt&quot;: 1,
    &quot;name&quot;: &quot;OpenWRT&quot;,
    &quot;version&quot;: &quot;22.03&quot;,
    &quot;url&quot;:&quot;http://127.0.0.1:8000/tedge/file-transfer/tedge-child/firmware_update/93d50a297a8c235&quot;,
    &quot;sha256&quot;:&quot;c036cbb7553a909f8b8877d4461924307f27ecb66cff928eeeafd569c3887e29&quot;
}
</code></pre>
<p>The fields in the request are describe below.</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>id</td><td>A unique id for the request. All responses must be sent back with the same id.</td></tr>
<tr><td>attempt</td><td>This <code>attempt</code> count can be used to differentiate between fresh requests and re-sent requests, as this <code>attempt</code> count will be higher than <code>1</code> if the same request is resent from thin-edge on rare occasions (e.g: thin-edge gets restarted while the child device is processing a firmware request).</td></tr>
<tr><td>name</td><td>Name of the firmware package</td></tr>
<tr><td>version</td><td>Version of the firmware package</td></tr>
<tr><td>sha256</td><td>The SHA-256 checksum of the firmware binary served in the <code>url</code> which can be used to verify the integrity of the downloaded package post-download.</td></tr>
</tbody></table>
<h3 id="send-executing-response-via-mqtt"><a class="header" href="#send-executing-response-via-mqtt">Send executing response via MQTT</a></h3>
<p>On receipt of the request, the connector may optionally send an &quot;executing&quot; MQTT status message,
to acknowledge the receipt of the request, as follows:</p>
<p><strong>Topic:</strong></p>
<p><code>tedge/{CHILD_ID}/commands/res/firmware_update</code></p>
<p><strong>Payload</strong>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;{OP_ID}&quot;,
    &quot;status&quot;: &quot;executing&quot;
}
</code></pre>
<p>where the <code>OP_ID</code> must match the <code>id</code> received in the <code>firmware_update</code> request.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-console">mosquitto_pub -h {TEDGE_DEVICE_IP} -t &quot;tedge/{CHILD_ID}/commands/res/firmware_update&quot; -m '{&quot;id&quot;: &quot;{OP_ID}&quot;, &quot;status&quot;: &quot;executing&quot;}'
</code></pre>
<h3 id="download-the-firmware-package-via-http"><a class="header" href="#download-the-firmware-package-via-http">Download the firmware package via HTTP</a></h3>
<p>After sending this status message, the connector must download the firmware file
from the <code>url</code> received in the request with an HTTP GET request.
Validating the integrity of the downloaded package by matching its SHA-256 hash value
against the <code>sha256</code> checksum received in the request is highly recommended.</p>
<h3 id="apply-the-firmware-package"><a class="header" href="#apply-the-firmware-package">Apply the firmware package</a></h3>
<p>The connector can then apply the downloaded firmware file update on the device.
This step is very device specific and might require use of other device specific protocols as well.</p>
<h3 id="send-successfulfailed-status-via-mqtt"><a class="header" href="#send-successfulfailed-status-via-mqtt">Send successful/failed status via MQTT</a></h3>
<p>Once the update is successfully applied, send a &quot;successful&quot; MQTT status message as follows:</p>
<p><strong>Topic:</strong></p>
<p><code>tedge/{CHILD_ID}/commands/res/firmware_update</code></p>
<p><strong>Payload</strong>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;{OP_ID}&quot;,
    &quot;status&quot;: &quot;successful&quot;
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-console">mosquitto_pub -h {TEDGE_DEVICE_IP} -t &quot;tedge/{CHILD_ID}/commands/res/firmware_update&quot; -m '{ &quot;id&quot;: &quot;{OP_ID}&quot;, &quot;status&quot;: &quot;successful&quot; }'
</code></pre>
<p>If there are any failures while downloading or applying the update,
a &quot;failed&quot; status update (with an optional <code>reason</code>) must be sent instead, to the same topic as follows:</p>
<p><strong>Payload</strong>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;{OP_ID}&quot;,
    &quot;status&quot;: &quot;failed&quot;,
    &quot;reason&quot;: &quot;Failure reason&quot;
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-console">mosquitto_pub -h {TEDGE_DEVICE_IP} -t &quot;tedge/{CHILD_ID}/commands/res/firmware_update&quot; -m '{ &quot;id&quot;: &quot;{OP_ID}&quot;, &quot;status&quot;: &quot;failed&quot;, &quot;reason&quot;: &quot;SHA-256 checksum validation failed&quot; }'
</code></pre>
<h2 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h2>
<p>To save bandwidth, thin-edge downloads a single firmware file only once and keeps it cached for reuse across multiple child devices,
as firmware updates could be applied to a fleet of devices together.
The cached files are stored under the tedge data directory <code>/var/tedge/cache</code>, by default.
Since thin-edge does not know how many devices it will be reused for and for how long, it can not clean them up on its own.
So, the user must manually delete the cached firmware files once the update is complete on all child devices.</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li>Reference implementation of a <a href="https://github.com/thin-edge/thin-edge.io_examples/tree/main/child-device-agent">child device connector</a> written in Python to demonstrate the contract described in this document.
This connector supports both configuration and firmware management operations.
So, just focus on the firmware management aspects.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../operate/c8y/child_device_config_management_agent.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../operate/c8y/remote_access_with_cumulocity.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../operate/c8y/child_device_config_management_agent.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../operate/c8y/remote_access_with_cumulocity.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script>
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>
        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>
        <script src="../../theme/pagetoc.js"></script>
    </div>
    </body>
</html>
