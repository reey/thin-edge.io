<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Supported Operations Management for Cumulocity IoT - thin-edge.io docs</title>
        <!-- Custom HTML head -->
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../././mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/pagetoc.css">
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item "><a href="../../start/index.html"><strong aria-hidden="true">2.</strong> Getting started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../start/getting-started.html"><strong aria-hidden="true">2.1.</strong> Getting started</a></li><li class="chapter-item "><a href="../../start/connect-c8y.html"><strong aria-hidden="true">2.2.</strong> Connect my device to Cumulocity IoT</a></li><li class="chapter-item "><a href="../../start/connect-azure.html"><strong aria-hidden="true">2.3.</strong> Connect my device to Azure IoT</a></li><li class="chapter-item "><a href="../../start/connect-aws.html"><strong aria-hidden="true">2.4.</strong> Connect my device to AWS IoT</a></li><li class="chapter-item "><a href="../../start/send-thin-edge-data.html"><strong aria-hidden="true">2.5.</strong> Send measurements</a></li><li class="chapter-item "><a href="../../start/raise-alarm.html"><strong aria-hidden="true">2.6.</strong> Raise alarms</a></li><li class="chapter-item "><a href="../../start/send-events.html"><strong aria-hidden="true">2.7.</strong> Send events</a></li><li class="chapter-item "><a href="../../start/device-monitoring.html"><strong aria-hidden="true">2.8.</strong> Monitor my device</a></li><li class="chapter-item "><a href="../../start/software-management.html"><strong aria-hidden="true">2.9.</strong> Manage my device software</a></li></ol></li><li class="chapter-item "><a href="../../understand/index.html"><strong aria-hidden="true">3.</strong> Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../understand/faq.html"><strong aria-hidden="true">3.1.</strong> Architecture FAQ</a></li><li class="chapter-item "><a href="../../understand/thin-edge-json.html"><strong aria-hidden="true">3.2.</strong> Thin Edge Json</a></li><li class="chapter-item "><a href="../../understand/mapper.html"><strong aria-hidden="true">3.3.</strong> The Mapper</a></li><li class="chapter-item "><a href="../../understand/software-management.html"><strong aria-hidden="true">3.4.</strong> Software Management</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/index.html"><strong aria-hidden="true">4.</strong> Operate devices</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/index.html"><strong aria-hidden="true">4.1.</strong> Installation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/installation.html"><strong aria-hidden="true">4.1.1.</strong> How to install thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/installation/installation_without_deb_support.html"><strong aria-hidden="true">4.1.2.</strong> How to install thin-edge.io on any Linux OS (no deb support)?</a></li><li class="chapter-item "><a href="../../operate/installation/how_to_install_thin_edge_manually.html"><strong aria-hidden="true">4.1.3.</strong> How to install thin-edge manually with openrc</a></li><li class="chapter-item "><a href="../../operate/installation/install_and_enable_software_management.html"><strong aria-hidden="true">4.1.4.</strong> How to install and enable software management?</a></li></ol></li><li class="chapter-item "><a href="../../operate/configuration/index.html"><strong aria-hidden="true">4.2.</strong> Configuration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/configuration/config.html"><strong aria-hidden="true">4.2.1.</strong> How to configure thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/configuration/config_local_mqtt_bind_address_and_port.html"><strong aria-hidden="true">4.2.2.</strong> How to configure the local mqtt bind address and port?</a></li><li class="chapter-item "><a href="../../operate/configuration/how_to_use_preferred_init_system.html"><strong aria-hidden="true">4.2.3.</strong> How to use thin-edge.io with your preferred init system</a></li><li class="chapter-item "><a href="../../operate/configuration/update_config_paths.html"><strong aria-hidden="true">4.2.4.</strong> How to change temp path?</a></li><li class="chapter-item "><a href="../../operate/configuration/child-device-config-management.html"><strong aria-hidden="true">4.2.5.</strong> Configuration management on child-devices</a></li></ol></li><li class="chapter-item "><a href="../../operate/security/index.html"><strong aria-hidden="true">4.3.</strong> Security and Access Control</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/security/registration.html"><strong aria-hidden="true">4.3.1.</strong> How to create a test certificate?</a></li><li class="chapter-item "><a href="../../operate/security/add_self_signed_trusted.html"><strong aria-hidden="true">4.3.2.</strong> How to add self-signed certificate root to trusted certificates list?</a></li><li class="chapter-item "><a href="../../operate/security/mqtt_local_broker_authentication.html"><strong aria-hidden="true">4.3.3.</strong> How to set up client/server authentication for the local MQTT broker</a></li></ol></li><li class="chapter-item "><a href="../../operate/connection/index.html"><strong aria-hidden="true">4.4.</strong> Connection to cloud</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/connection/connect.html"><strong aria-hidden="true">4.4.1.</strong> How to connect cloud end-point?</a></li></ol></li><li class="chapter-item "><a href="../../operate/telemetry/index.html"><strong aria-hidden="true">4.5.</strong> Processing Telemetry Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/telemetry/pub_sub.html"><strong aria-hidden="true">4.5.1.</strong> How to use tedge mqtt?</a></li></ol></li><li class="chapter-item "><a href="../../operate/operations/index.html"><strong aria-hidden="true">4.6.</strong> Operations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/operations/restart_device_operation.html"><strong aria-hidden="true">4.6.1.</strong> How to restart your thin-edge.io device</a></li></ol></li><li class="chapter-item "><a href="../../operate/monitoring/index.html"><strong aria-hidden="true">4.7.</strong> Monitoring</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/monitoring/enable_tedge_watchdog_using_systemd.html"><strong aria-hidden="true">4.7.1.</strong> How to enable watchdog using systemd?</a></li><li class="chapter-item "><a href="../../operate/monitoring/connect_external_device.html"><strong aria-hidden="true">4.7.2.</strong> How to connect an external device?</a></li></ol></li><li class="chapter-item "><a href="../../operate/troubleshooting/index.html"><strong aria-hidden="true">4.8.</strong> Troubleshooting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/troubleshooting/test_connection.html"><strong aria-hidden="true">4.8.1.</strong> How to test the cloud connection?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/thin_edge_logs.html"><strong aria-hidden="true">4.8.2.</strong> How to access the logs on the device?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/monitor_tedge_health.html"><strong aria-hidden="true">4.8.3.</strong> How to monitor health of tedge daemons</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/trouble_shooting_monitoring.html"><strong aria-hidden="true">4.8.4.</strong> How to trouble shoot device monitoring?</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/c8y/index.html"><strong aria-hidden="true">4.9.</strong> Device Management with Cumulocity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../operate/c8y/supported_operations.html" class="active"><strong aria-hidden="true">4.9.1.</strong> Supported Operations Management for Cumulocity IoT</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_fragments.html"><strong aria-hidden="true">4.9.2.</strong> How to add custom fragments to Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_log_plugin.html"><strong aria-hidden="true">4.9.3.</strong> How to retrieve logs with the log plugin</a></li><li class="chapter-item "><a href="../../operate/c8y/smartrest_templates.html"><strong aria-hidden="true">4.9.4.</strong> How to add C8Y SmartRest Templates</a></li><li class="chapter-item "><a href="../../operate/c8y/config_management_plugin.html"><strong aria-hidden="true">4.9.5.</strong> How to manage configuration files with Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/child_device_config_management_agent.html"><strong aria-hidden="true">4.9.6.</strong> How to enable configuration management on child devices</a></li><li class="chapter-item "><a href="../../operate/c8y/child_device_firmware_management.html"><strong aria-hidden="true">4.9.7.</strong> How to enable firmware management on child devices</a></li><li class="chapter-item "><a href="../../operate/c8y/remote_access_with_cumulocity.html"><strong aria-hidden="true">4.9.8.</strong> How to remotely connect to your thin-edge.io device via SSH/VNC/Telnet with Cumulocity remote access</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_service_monitoring.html"><strong aria-hidden="true">4.9.9.</strong> How to monitor a service from Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/apama_software_management_plugin.html"><strong aria-hidden="true">4.9.10.</strong> How to manage Apama software artifacts with Apama plugin?</a></li><li class="chapter-item "><a href="../../operate/c8y/retrieve_jwt_token_from_cumulocity.html"><strong aria-hidden="true">4.9.11.</strong> How to retrieve JWT token from Cumulocity?</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../extend/index.html"><strong aria-hidden="true">5.</strong> Extend thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extend/write-my-software-management-plugin.html"><strong aria-hidden="true">5.1.</strong> Write my software management plugin</a></li><li class="chapter-item "><a href="../../extend/yocto-linux.html"><strong aria-hidden="true">5.2.</strong> Build Thin Edge for a Yocto Linux distribution</a></li></ol></li><li class="chapter-item "><a href="../../contribute/index.html"><strong aria-hidden="true">6.</strong> Contribute to thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../contribute/BUILDING.html"><strong aria-hidden="true">6.1.</strong> Building</a></li><li class="chapter-item "><a href="../../contribute/DEV_CONTAINER.html"><strong aria-hidden="true">6.2.</strong> Using a dev container</a></li><li class="chapter-item "><a href="../../contribute/DEBIAN_PACKAGE_HOSTING.html"><strong aria-hidden="true">6.3.</strong> Debian package hosting</a></li><li class="chapter-item "><a href="../../contribute/INSTALLING_DOCKER.html"><strong aria-hidden="true">6.4.</strong> Installing Docker</a></li></ol></li><li class="chapter-item "><a href="../../references/index.html"><strong aria-hidden="true">7.</strong> Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/supported-platforms.html"><strong aria-hidden="true">7.1.</strong> Supported platforms</a></li><li class="chapter-item "><a href="../../references/thin-edge-config-files.html"><strong aria-hidden="true">7.2.</strong> Thin-edge.io configuration files</a></li><li class="chapter-item "><a href="../../references/bridged-topics.html"><strong aria-hidden="true">7.3.</strong> MQTT bridge configuration</a></li><li class="chapter-item "><a href="../../references/init-system-config.html"><strong aria-hidden="true">7.4.</strong> Init System Configuration File</a></li><li class="chapter-item "><a href="../../references/tedge.html"><strong aria-hidden="true">7.5.</strong> tedge command</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/tedge-cert.html"><strong aria-hidden="true">7.5.1.</strong> tedge cert command</a></li><li class="chapter-item "><a href="../../references/tedge-config.html"><strong aria-hidden="true">7.5.2.</strong> tedge config command</a></li><li class="chapter-item "><a href="../../references/tedge-connect.html"><strong aria-hidden="true">7.5.3.</strong> tedge connect command</a></li><li class="chapter-item "><a href="../../references/tedge-disconnect.html"><strong aria-hidden="true">7.5.4.</strong> tedge disconnect command</a></li><li class="chapter-item "><a href="../../references/tedge-mqtt.html"><strong aria-hidden="true">7.5.5.</strong> tedge mqtt command</a></li></ol></li><li class="chapter-item "><a href="../../understand/domain-model.html"><strong aria-hidden="true">7.6.</strong> Domain Model</a></li><li class="chapter-item "><a href="../../understand/data-model.html"><strong aria-hidden="true">7.7.</strong> Data Model</a></li><li class="chapter-item "><a href="../../references/plugin-api.html"><strong aria-hidden="true">7.8.</strong> Plugin API</a></li><li class="chapter-item "><a href="../../references/c8y-log-management.html"><strong aria-hidden="true">7.9.</strong> Log Management</a></li><li class="chapter-item "><a href="../../references/c8y-configuration-management.html"><strong aria-hidden="true">7.10.</strong> Configuration Management</a></li><li class="chapter-item "><a href="../../references/c8y-firmware-management.html"><strong aria-hidden="true">7.11.</strong> Firmware Management</a></li><li class="chapter-item "><a href="../../references/tedge-file-transfer-service.html"><strong aria-hidden="true">7.12.</strong> Thin Edge File Transfer Service</a></li></ol></li><li class="chapter-item "><a href="../../SUMMARY.html"><strong aria-hidden="true">8.</strong> Index</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">thin-edge.io docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <h1 id="thin-edgeio-supported-operations"><a class="header" href="#thin-edgeio-supported-operations">thin-edge.io Supported Operations</a></h1>
<h2 id="supported-operations-concepts"><a class="header" href="#supported-operations-concepts">Supported Operations concepts</a></h2>
<h3 id="device-operations"><a class="header" href="#device-operations">Device operations</a></h3>
<p>IoT devices often do more than just send data to the cloud. They also do things like:</p>
<ul>
<li>receive triggers from the operator</li>
<li>reboot on demand</li>
<li>install or remove software</li>
</ul>
<p>These operations are supported by <a href="https://cumulocity.com/api/10.11.0/#section/Device-management-library">Cumulocity IoT</a> and other cloud providers.
On <code>thin-edge.io</code> the support for one such operation can be added using the <code>thin-edge.io</code> Supported Operations API.</p>
<h3 id="thin-edgeio-supported-operations-api"><a class="header" href="#thin-edgeio-supported-operations-api"><code>thin-edge.io</code> Supported Operations API</a></h3>
<p>The Supported Operations utilises the file system to add and remove operations. A special file placed in <code>/etc/tedge/operations</code> directory will indicate that an operation is supported.
The specification for the operation files is described in <code>thin-edge.io</code> specifications repository <a href="https://github.com/thin-edge/thin-edge.io-specs/blob/main/src/supported-operations/README.md">src/supported-operations/README.md</a></p>
<p>Supported operations are declared in the cloud specific subdirectory of <code>/etc/tedge/operations</code> directory.</p>
<h2 id="custom-supported-operations"><a class="header" href="#custom-supported-operations">Custom Supported Operations</a></h2>
<p><code>thin-edge.io</code> supports custom operations by using configuration files and plugin mechanism similar to what software management agent does.</p>
<p>The main difference between custom operations and native operations is that custom operations are have to be defined in configuration files and provide their own implementation in a callable <code>plugin</code> executable.
As per specification the configuration file needs to be a <code>toml</code> file which describes the operation.</p>
<p><code>thin-edge.io</code> stores the operations configuration files in the <code>/etc/tedge/operations/&lt;cloud-provider&gt;/</code> directory.</p>
<h2 id="supported-operations-for-child-devices"><a class="header" href="#supported-operations-for-child-devices">Supported Operations for Child Devices</a></h2>
<p>When a new child device is bootstrapped, it needs to create <code>/etc/tedge/operations/&lt;cloud-provider&gt;/&lt;child- device&gt;</code> directory to store the supported operations of that child device.
Every file placed in the <code>/etc/tedge/operations/&lt;cloud-provider&gt;/&lt;child-device&gt;</code> directory represents an operation supported by that child device.
The operation files can be dynamically added and removed.</p>
<h2 id="thin-edgeio-list-of-supported-operations"><a class="header" href="#thin-edgeio-list-of-supported-operations"><code>thin-edge.io</code> List of Supported Operations</a></h2>
<p><code>thin-edge.io</code> supports natively the following operations:</p>
<ul>
<li>Software Update</li>
<li>Software Update Log Upload</li>
<li>Restart</li>
</ul>
<p>The list is growing as we support more operations, but is not exhaustive and we encourage you to contribute to the list.</p>
<h2 id="how-to-use-supported-operations"><a class="header" href="#how-to-use-supported-operations">How to use Supported Operations</a></h2>
<h3 id="listing-current-operations"><a class="header" href="#listing-current-operations">Listing current operations</a></h3>
<p>You can obtain the current list of supported operations by listing the content of the <code>/etc/tedge/operations</code> directory.
This directory should have permissions set to <code>755</code> and the owner to <code>tedge</code>.
This directory will contain a set subdirectories based on cloud providers currently supported eg:</p>
<pre><code class="language-shell">ls -l /etc/tedge/operations

drwxr-xr-x 2 tedge tedge 4096 Jan 01 00:00 az
drwxr-xr-x 2 tedge tedge 4096 Jan 01 00:00 c8y
</code></pre>
<p>From the above you can see that there are three cloud providers supported by <code>thin-edge.io</code>.
The directories should be readable by <code>thin-edge.io</code> user - <code>tedge</code> - and should have permissions <code>755</code>.</p>
<p>To list all currently supported operations for a cloud provider, run:</p>
<pre><code class="language-shell">ls -l /etc/tedge/operations/c8y

-rw-r--r-- 1 tedge tedge 0 Jan 01 00:00 c8y_Restart
</code></pre>
<p>To list all currently supported operations, run:
The operations files should have permissions <code>644</code> and the owner <code>tedge</code>.</p>
<pre><code class="language-shell">sudo ls -lR /etc/tedge/operations
</code></pre>
<pre><code>/etc/tedge/operations:
drwxr-xr-x 2 tedge tedge 4096 Jan 01 00:00 az
drwxr-xr-x 2 tedge tedge 4096 Jan 01 00:00 c8y

/etc/tedge/operations/az:
-rw-r--r-- 1 tedge tedge 0 Jan 01 00:00 Restart

/etc/tedge/operations/c8y:
-rw-r--r-- 1 tedge tedge 0 Jan 01 00:00 c8y_Restart
</code></pre>
<p>One can list all the currently supported operations for a child device as below</p>
<pre><code class="language-shell">sudo ls -lR /etc/tedge/operations/c8y/&lt;child-device&gt;
</code></pre>
<pre><code>-rw-r--r-- 1 tedge tedge 0 Oct 26 11:24 c8y_LogfileRequest
</code></pre>
<h3 id="adding-new-operations"><a class="header" href="#adding-new-operations">Adding new operations</a></h3>
<p>To add new operation we need to create new file in <code>/etc/tedge/operations</code> directory.
Before we create that file we have to know which cloud provider we are going to support (it is possible to support multiple cloud providers, but we won't cover this here).</p>
<p>We will add operation <code>Restart</code> for our device which can be triggered from Cumulocity IoT called, in Cumulocity IoT this operations name is <code>c8y_Restart</code>.
This operation will do the reboot of our device when we receive trigger from the operator. <code>thin-edge.io</code> device will receive an MQTT message with certain payload and we already have a handler for that payload in the <code>tedge-mapper-c8y</code>.</p>
<p>To add new operation we will create a file in <code>/etc/tedge/operations/c8y</code> directory:</p>
<pre><code class="language-shell">sudo -u tedge touch /etc/tedge/operations/c8y/c8y_Restart
</code></pre>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note"></a></p>
</div>
<div>
<p>We are using <code>sudo -u</code> to create the file because we want to make sure that the file is owned by <code>tedge</code> user.</p>
</div>
</div>
<p>Now the new operation will be automatically added to the list and the list will be sent to the cloud.</p>
<p>To add a new operation to a child device, create a new file in <code>/etc/tedge/operations/c8y/&lt;child-device&gt;</code> directory as below.</p>
<pre><code class="language-shell">sudo -u tedge touch /etc/tedge/operations/c8y/&lt;child-device&gt;/c8y_Restart
</code></pre>
<p>Now the new operation will be automatically added to the list of child supported operations and will be sent to the cloud.</p>
<h3 id="removing-supported-operations"><a class="header" href="#removing-supported-operations">Removing supported operations</a></h3>
<p>To remove a supported operation for a thin-edge device, the corresponding operation file must be removed from the <code>/etc/tedge/operations/c8y</code> directory. eg:</p>
<pre><code class="language-shell">sudo rm /etc/tedge/operations/c8y/c8y_Restart
</code></pre>
<p>Similarly, the supported operation for a child device can be removed by removing the corresponding operation file from the child device operations directory
at <code>/etc/tedge/operations/c8y/&lt;child-device&gt;</code>. Eg:</p>
<pre><code class="language-shell">sudo rm /etc/tedge/operations/c8y/&lt;child-device&gt;/c8y_Restart
</code></pre>
<p>Now the operation will be automatically removed from the list and the list will be sent to the cloud.</p>
<h2 id="working-with-custom-operations"><a class="header" href="#working-with-custom-operations">Working with custom operations</a></h2>
<p>We will use the <code>thin-edge.io</code> Supported Operations API to add custom operations. Our new operation is going to be capability to execute shell commands on the device.
Let's create the operation configuration file:</p>
<p>We need to tell <code>thin-edge.io</code> how to handle the operation and how to execute it.</p>
<h3 id="adding-new-custom-operation"><a class="header" href="#adding-new-custom-operation">Adding new custom operation</a></h3>
<p>In Cumulocity IoT we know that there is an operation call c8y_Command which allows us to send commands to the device and get the result back to the cloud, let's create the configuration file for our new operation:</p>
<p>First we create a file with the name of the operation:</p>
<pre><code class="language-shell">sudo -u tedge touch /etc/tedge/operations/c8y/c8y_Command
</code></pre>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note-1"></a></p>
</div>
<div>
<p>The needs to be readable by <code>thin-edge.io</code> user - <code>tedge</code> - and should have permissions <code>644</code>.</p>
</div>
</div>
<p>In this example we want <code>thin-edge.io</code> to pick up a message on specific topic and execute the command on the device, our topic is <code>c8y/s/ds</code>.
We also know that the message we expect is going to use SmartRest template <code>511</code> and our plugin is located in <code>/etc/tedge/operations/command</code>.
The operation is configured to <code>timeout</code> after 10 seconds, to avoid it from running for too long/forever.</p>
<p>Then we need to add the configuration to the file (<code>/etc/tedge/operations/c8y/c8y_Command</code>):</p>
<pre><code class="language-toml">[exec]
  topic = &quot;c8y/s/ds&quot;
  on_message = &quot;511&quot;
  command = &quot;/etc/tedge/operations/command&quot;
  timeout = 10
</code></pre>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note-2"></a></p>
</div>
<div>
<p>The <code>timeout</code> that is configured will be in seconds. If a custom operation is not configured with a <code>timeout</code> value, then it will use default <code>timeout</code>,.i.e. 3600 seconds.
If the operation does not complete within that specified <code>timeout</code> period, then the operation will be stopped/killed, and marked as failed in the cloud.</p>
</div>
</div>
<p>And now the content of our command plugin:</p>
<pre><code class="language-shell">#!/bin/bash
# Parse the smart rest message, ignore the first two field, and everything afterwards is the command
COMMAND=&quot;${1#*,*,}&quot;

# Check if command is wrapped with quotes, if so then remove them
if [[ &quot;$COMMAND&quot; == \&quot;*\&quot; ]]; then
    COMMAND=&quot;${COMMAND:1:-1}&quot;
fi

# Execute command
bash -c &quot;$COMMAND&quot;
EXIT_CODE=$?
if [ $EXIT_CODE -ne 0 ]; then
    echo &quot;Command returned a non-zero exit code. code=$EXIT_CODE&quot; &gt;&amp;2
fi

exit &quot;$EXIT_CODE&quot;
</code></pre>
<p>This simple example will parse the third field of the received SmartREST message and execute the command.
If it exits with the status code <code>0</code>, a successful message with the stdout content will be reported to Cumulocity.
If it exits with a non-zero code, a failure message with the stderr content will be sent out.</p>
<div id="admonition-note-3" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note-3"></a></p>
</div>
<div>
<p>The command will be executed with tedge-mapper permission level so most of the system level commands will not work.</p>
</div>
</div>
<h3 id="list-of-currently-supported-operations-parameters"><a class="header" href="#list-of-currently-supported-operations-parameters">List of currently supported operations parameters</a></h3>
<ul>
<li><code>topic</code> - The topic on which the operation will be executed.</li>
<li><code>on_message</code> - The SmartRest template on which the operation will be executed.</li>
<li><code>command</code> - The command to execute.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../operate/c8y/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../operate/c8y/c8y_fragments.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../operate/c8y/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../operate/c8y/c8y_fragments.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script>
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>
        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>
        <script src="../../theme/pagetoc.js"></script>
    </div>
    </body>
</html>
