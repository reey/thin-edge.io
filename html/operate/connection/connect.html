<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to connect cloud end-point? - thin-edge.io docs</title>
        <!-- Custom HTML head -->
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../././mdbook-admonish.css">
        <link rel="stylesheet" href="../../theme/pagetoc.css">
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item "><a href="../../start/index.html"><strong aria-hidden="true">2.</strong> Getting started</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../start/getting-started.html"><strong aria-hidden="true">2.1.</strong> Getting started</a></li><li class="chapter-item "><a href="../../start/connect-c8y.html"><strong aria-hidden="true">2.2.</strong> Connect my device to Cumulocity IoT</a></li><li class="chapter-item "><a href="../../start/connect-azure.html"><strong aria-hidden="true">2.3.</strong> Connect my device to Azure IoT</a></li><li class="chapter-item "><a href="../../start/connect-aws.html"><strong aria-hidden="true">2.4.</strong> Connect my device to AWS IoT</a></li><li class="chapter-item "><a href="../../start/send-thin-edge-data.html"><strong aria-hidden="true">2.5.</strong> Send measurements</a></li><li class="chapter-item "><a href="../../start/raise-alarm.html"><strong aria-hidden="true">2.6.</strong> Raise alarms</a></li><li class="chapter-item "><a href="../../start/send-events.html"><strong aria-hidden="true">2.7.</strong> Send events</a></li><li class="chapter-item "><a href="../../start/device-monitoring.html"><strong aria-hidden="true">2.8.</strong> Monitor my device</a></li><li class="chapter-item "><a href="../../start/software-management.html"><strong aria-hidden="true">2.9.</strong> Manage my device software</a></li></ol></li><li class="chapter-item "><a href="../../understand/index.html"><strong aria-hidden="true">3.</strong> Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../understand/faq.html"><strong aria-hidden="true">3.1.</strong> Architecture FAQ</a></li><li class="chapter-item "><a href="../../understand/thin-edge-json.html"><strong aria-hidden="true">3.2.</strong> Thin Edge Json</a></li><li class="chapter-item "><a href="../../understand/mapper.html"><strong aria-hidden="true">3.3.</strong> The Mapper</a></li><li class="chapter-item "><a href="../../understand/software-management.html"><strong aria-hidden="true">3.4.</strong> Software Management</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/index.html"><strong aria-hidden="true">4.</strong> Operate devices</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/index.html"><strong aria-hidden="true">4.1.</strong> Installation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/installation/installation.html"><strong aria-hidden="true">4.1.1.</strong> How to install thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/installation/installation_without_deb_support.html"><strong aria-hidden="true">4.1.2.</strong> How to install thin-edge.io on any Linux OS (no deb support)?</a></li><li class="chapter-item "><a href="../../operate/installation/how_to_install_thin_edge_manually.html"><strong aria-hidden="true">4.1.3.</strong> How to install thin-edge manually with openrc</a></li><li class="chapter-item "><a href="../../operate/installation/install_and_enable_software_management.html"><strong aria-hidden="true">4.1.4.</strong> How to install and enable software management?</a></li></ol></li><li class="chapter-item "><a href="../../operate/configuration/index.html"><strong aria-hidden="true">4.2.</strong> Configuration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/configuration/config.html"><strong aria-hidden="true">4.2.1.</strong> How to configure thin-edge.io?</a></li><li class="chapter-item "><a href="../../operate/configuration/config_local_mqtt_bind_address_and_port.html"><strong aria-hidden="true">4.2.2.</strong> How to configure the local mqtt bind address and port?</a></li><li class="chapter-item "><a href="../../operate/configuration/how_to_use_preferred_init_system.html"><strong aria-hidden="true">4.2.3.</strong> How to use thin-edge.io with your preferred init system</a></li><li class="chapter-item "><a href="../../operate/configuration/update_config_paths.html"><strong aria-hidden="true">4.2.4.</strong> How to change temp path?</a></li><li class="chapter-item "><a href="../../operate/configuration/child-device-config-management.html"><strong aria-hidden="true">4.2.5.</strong> Configuration management on child-devices</a></li></ol></li><li class="chapter-item "><a href="../../operate/security/index.html"><strong aria-hidden="true">4.3.</strong> Security and Access Control</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/security/registration.html"><strong aria-hidden="true">4.3.1.</strong> How to create a test certificate?</a></li><li class="chapter-item "><a href="../../operate/security/add_self_signed_trusted.html"><strong aria-hidden="true">4.3.2.</strong> How to add self-signed certificate root to trusted certificates list?</a></li><li class="chapter-item "><a href="../../operate/security/mqtt_local_broker_authentication.html"><strong aria-hidden="true">4.3.3.</strong> How to set up client/server authentication for the local MQTT broker</a></li></ol></li><li class="chapter-item expanded "><a href="../../operate/connection/index.html"><strong aria-hidden="true">4.4.</strong> Connection to cloud</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../operate/connection/connect.html" class="active"><strong aria-hidden="true">4.4.1.</strong> How to connect cloud end-point?</a></li></ol></li><li class="chapter-item "><a href="../../operate/telemetry/index.html"><strong aria-hidden="true">4.5.</strong> Processing Telemetry Data</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/telemetry/pub_sub.html"><strong aria-hidden="true">4.5.1.</strong> How to use tedge mqtt?</a></li></ol></li><li class="chapter-item "><a href="../../operate/operations/index.html"><strong aria-hidden="true">4.6.</strong> Operations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/operations/restart_device_operation.html"><strong aria-hidden="true">4.6.1.</strong> How to restart your thin-edge.io device</a></li></ol></li><li class="chapter-item "><a href="../../operate/monitoring/index.html"><strong aria-hidden="true">4.7.</strong> Monitoring</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/monitoring/enable_tedge_watchdog_using_systemd.html"><strong aria-hidden="true">4.7.1.</strong> How to enable watchdog using systemd?</a></li><li class="chapter-item "><a href="../../operate/monitoring/connect_external_device.html"><strong aria-hidden="true">4.7.2.</strong> How to connect an external device?</a></li></ol></li><li class="chapter-item "><a href="../../operate/troubleshooting/index.html"><strong aria-hidden="true">4.8.</strong> Troubleshooting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/troubleshooting/test_connection.html"><strong aria-hidden="true">4.8.1.</strong> How to test the cloud connection?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/thin_edge_logs.html"><strong aria-hidden="true">4.8.2.</strong> How to access the logs on the device?</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/monitor_tedge_health.html"><strong aria-hidden="true">4.8.3.</strong> How to monitor health of tedge daemons</a></li><li class="chapter-item "><a href="../../operate/troubleshooting/trouble_shooting_monitoring.html"><strong aria-hidden="true">4.8.4.</strong> How to trouble shoot device monitoring?</a></li></ol></li><li class="chapter-item "><a href="../../operate/c8y/index.html"><strong aria-hidden="true">4.9.</strong> Device Management with Cumulocity</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../operate/c8y/supported_operations.html"><strong aria-hidden="true">4.9.1.</strong> Supported Operations Management for Cumulocity IoT</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_fragments.html"><strong aria-hidden="true">4.9.2.</strong> How to add custom fragments to Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_log_plugin.html"><strong aria-hidden="true">4.9.3.</strong> How to retrieve logs with the log plugin</a></li><li class="chapter-item "><a href="../../operate/c8y/smartrest_templates.html"><strong aria-hidden="true">4.9.4.</strong> How to add C8Y SmartRest Templates</a></li><li class="chapter-item "><a href="../../operate/c8y/config_management_plugin.html"><strong aria-hidden="true">4.9.5.</strong> How to manage configuration files with Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/child_device_config_management_agent.html"><strong aria-hidden="true">4.9.6.</strong> How to enable configuration management on child devices</a></li><li class="chapter-item "><a href="../../operate/c8y/child_device_firmware_management.html"><strong aria-hidden="true">4.9.7.</strong> How to enable firmware management on child devices</a></li><li class="chapter-item "><a href="../../operate/c8y/remote_access_with_cumulocity.html"><strong aria-hidden="true">4.9.8.</strong> How to remotely connect to your thin-edge.io device via SSH/VNC/Telnet with Cumulocity remote access</a></li><li class="chapter-item "><a href="../../operate/c8y/c8y_service_monitoring.html"><strong aria-hidden="true">4.9.9.</strong> How to monitor a service from Cumulocity</a></li><li class="chapter-item "><a href="../../operate/c8y/apama_software_management_plugin.html"><strong aria-hidden="true">4.9.10.</strong> How to manage Apama software artifacts with Apama plugin?</a></li><li class="chapter-item "><a href="../../operate/c8y/retrieve_jwt_token_from_cumulocity.html"><strong aria-hidden="true">4.9.11.</strong> How to retrieve JWT token from Cumulocity?</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../extend/index.html"><strong aria-hidden="true">5.</strong> Extend thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../extend/write-my-software-management-plugin.html"><strong aria-hidden="true">5.1.</strong> Write my software management plugin</a></li><li class="chapter-item "><a href="../../extend/yocto-linux.html"><strong aria-hidden="true">5.2.</strong> Build Thin Edge for a Yocto Linux distribution</a></li></ol></li><li class="chapter-item "><a href="../../contribute/index.html"><strong aria-hidden="true">6.</strong> Contribute to thin-edge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../contribute/BUILDING.html"><strong aria-hidden="true">6.1.</strong> Building</a></li><li class="chapter-item "><a href="../../contribute/DEV_CONTAINER.html"><strong aria-hidden="true">6.2.</strong> Using a dev container</a></li><li class="chapter-item "><a href="../../contribute/DEBIAN_PACKAGE_HOSTING.html"><strong aria-hidden="true">6.3.</strong> Debian package hosting</a></li><li class="chapter-item "><a href="../../contribute/INSTALLING_DOCKER.html"><strong aria-hidden="true">6.4.</strong> Installing Docker</a></li></ol></li><li class="chapter-item "><a href="../../references/index.html"><strong aria-hidden="true">7.</strong> Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/supported-platforms.html"><strong aria-hidden="true">7.1.</strong> Supported platforms</a></li><li class="chapter-item "><a href="../../references/thin-edge-config-files.html"><strong aria-hidden="true">7.2.</strong> Thin-edge.io configuration files</a></li><li class="chapter-item "><a href="../../references/bridged-topics.html"><strong aria-hidden="true">7.3.</strong> MQTT bridge configuration</a></li><li class="chapter-item "><a href="../../references/init-system-config.html"><strong aria-hidden="true">7.4.</strong> Init System Configuration File</a></li><li class="chapter-item "><a href="../../references/tedge.html"><strong aria-hidden="true">7.5.</strong> tedge command</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../references/tedge-cert.html"><strong aria-hidden="true">7.5.1.</strong> tedge cert command</a></li><li class="chapter-item "><a href="../../references/tedge-config.html"><strong aria-hidden="true">7.5.2.</strong> tedge config command</a></li><li class="chapter-item "><a href="../../references/tedge-connect.html"><strong aria-hidden="true">7.5.3.</strong> tedge connect command</a></li><li class="chapter-item "><a href="../../references/tedge-disconnect.html"><strong aria-hidden="true">7.5.4.</strong> tedge disconnect command</a></li><li class="chapter-item "><a href="../../references/tedge-mqtt.html"><strong aria-hidden="true">7.5.5.</strong> tedge mqtt command</a></li></ol></li><li class="chapter-item "><a href="../../understand/domain-model.html"><strong aria-hidden="true">7.6.</strong> Domain Model</a></li><li class="chapter-item "><a href="../../understand/data-model.html"><strong aria-hidden="true">7.7.</strong> Data Model</a></li><li class="chapter-item "><a href="../../references/plugin-api.html"><strong aria-hidden="true">7.8.</strong> Plugin API</a></li><li class="chapter-item "><a href="../../references/c8y-log-management.html"><strong aria-hidden="true">7.9.</strong> Log Management</a></li><li class="chapter-item "><a href="../../references/c8y-configuration-management.html"><strong aria-hidden="true">7.10.</strong> Configuration Management</a></li><li class="chapter-item "><a href="../../references/c8y-firmware-management.html"><strong aria-hidden="true">7.11.</strong> Firmware Management</a></li><li class="chapter-item "><a href="../../references/tedge-file-transfer-service.html"><strong aria-hidden="true">7.12.</strong> Thin Edge File Transfer Service</a></li></ol></li><li class="chapter-item "><a href="../../SUMMARY.html"><strong aria-hidden="true">8.</strong> Index</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">thin-edge.io docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <h1 id="how-to-connect"><a class="header" href="#how-to-connect">How to connect?</a></h1>
<h2 id="connect-to-cumulocity-iot"><a class="header" href="#connect-to-cumulocity-iot">Connect to Cumulocity IoT</a></h2>
<p>To create northbound connection a local bridge shall be established and this can be achieved with <code>tedge</code> cli and following commands:</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note"></a></p>
</div>
<div>
<p>Note: <code>tedge connect</code> requires <code>sudo</code> privilege.</p>
</div>
</div>
<h2 id="setting-the-cloud-end-point"><a class="header" href="#setting-the-cloud-end-point">Setting the cloud end-point</a></h2>
<p>Configure required parameters for thin-edge.io with <a href="../../references/tedge-config.html"><code>tedge config set</code></a>:</p>
<pre><code class="language-shell">sudo tedge config set c8y.url example.cumulocity.com
</code></pre>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="#admonition-info"></a></p>
</div>
<div>
<p>If you are unsure which parameters required by the command, simply run the command and it will tell you which parameters are missing.</p>
<p>For example, if we issue <a href="../references/tedge-connect.html"><code>tedge connect c8y</code></a> without any configuration following advice will be given:</p>
<blockquote>
<pre><code class="language-shell">$ tedge connect c8y`
...
Error: failed to execute `tedge connect`.

Caused by:
    Required configuration item is not provided 'c8y.url', run 'tedge config set c8y.url &lt;value&gt;' to add it to config.
</code></pre>
</blockquote>
<p>This message explains which configuration parameter is missing and how to add it to configuration,
in this case we are told to run <code>tedge config set c8y.url &lt;value&gt;</code>.</p>
</div>
</div>
<h2 id="making-the-cloud-trust-the-device"><a class="header" href="#making-the-cloud-trust-the-device">Making the cloud trust the device</a></h2>
<p>The next step is to have the device certificate trusted by Cumulocity. This is done by uploading the certificate of the signee.
You can upload the root certificate using the <a href="https://cumulocity.com/guides/users-guide/device-management/#trusted-certificates">Cumulocity UI</a>
or with <a href="../../references/tedge-cert.html"><code>tedge cert upload</code></a> command as described below.</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note-1"></a></p>
</div>
<div>
<p>The <code>tedge cert upload</code> command requires the credentials of a Cumulocity user
having the permissions to upload trusted certificates on the Cumulocity tenant of the device.</p>
<p>The user name is provided as <code>--user &lt;username&gt;</code> parameter,
and the command will prompt you for this user's password.
These credentials are used only for this upload and will in no case be stored on the device.</p>
</div>
</div>
<pre><code class="language-shell">sudo tedge cert upload c8y --user &lt;username&gt;
</code></pre>
<h2 id="creating-an-mqtt-bridge-between-the-device-and-the-cloud"><a class="header" href="#creating-an-mqtt-bridge-between-the-device-and-the-cloud">Creating an MQTT bridge between the device and the cloud</a></h2>
<p>The connection from the device to the cloud is established using a so-called MQTT bridge:
a permanent secured bidirectional MQTT connection that forward messages back and forth
between the two end-points.</p>
<p>To create the bridge use the <a href="../../references/tedge-connect.html"><code>tedge connect</code></a> command.</p>
<pre><code class="language-shell">sudo tedge connect c8y
</code></pre>
<pre><code>Checking if systemd is available.

Checking if configuration for requested bridge already exists.

Validating the bridge certificates.

Creating the device in Cumulocity cloud.

Saving configuration for requested bridge.

Restarting mosquitto service.

Awaiting mosquitto to start. This may take up to 5 seconds.

Enabling mosquitto service on reboots.

Successfully created bridge connection!

Sending packets to check connection. This may take up to 2 seconds.

Connection check is successful.

Checking if tedge-mapper is installed.

Starting tedge-mapper-c8y service.

Persisting tedge-mapper-c8y on reboot.

tedge-mapper-c8y service successfully started and enabled!

Enabling software management.

Checking if tedge-agent is installed.

Starting tedge-agent service.

Persisting tedge-agent on reboot.

tedge-agent service successfully started and enabled!
</code></pre>
<h3 id="errors"><a class="header" href="#errors">Errors</a></h3>
<h4 id="connection-already-established"><a class="header" href="#connection-already-established">Connection already established</a></h4>
<p>If connection has already been established following error may appear:</p>
<pre><code class="language-shell">sudo tedge connect c8y
</code></pre>
<pre><code>Checking if systemd is available.

Checking if configuration for requested bridge already exists.

Error: failed to create bridge to connect Cumulocity cloud.

Caused by:
    Connection is already established. To remove existing connection use 'tedge disconnect c8y' and try again.
</code></pre>
<p>To remove existing connection and create new one follow the advice and issue <a href="../../references/tedge-disconnect.html"><code>tedge disconnect c8y</code></a>:</p>
<pre><code class="language-shell">sudo tedge disconnect c8y
</code></pre>
<pre><code>Removing Cumulocity bridge.

Applying changes to mosquitto.

Cumulocity Bridge successfully disconnected!

Stopping tedge-mapper-c8y service.

Disabling tedge-mapper-c8y service.

tedge-mapper-c8y service successfully stopped and disabled!

Stopping tedge-agent service.

Disabling tedge-agent service.

tedge-agent service successfully stopped and disabled!
</code></pre>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note-2"></a></p>
</div>
<div>
<p><code>tedge disconnect c8y</code> also stops and disable the <strong>tedge-mapper</strong> service if it is installed on the device.</p>
</div>
</div>
<p>And now you can issue <a href="../../references/tedge-connect.html"><code>tedge connect c8y</code></a> to create new bridge.</p>
<h4 id="connection-check-warning"><a class="header" href="#connection-check-warning">Connection check warning</a></h4>
<p>Sample output of tedge connect when this warning occurs:</p>
<pre><code class="language-shell">sudo tedge connect c8y
</code></pre>
<pre><code>Checking if systemd is available.

Checking if configuration for requested bridge already exists.

Validating the bridge certificates.

Creating the device in Cumulocity cloud.

Saving configuration for requested bridge.

Restarting mosquitto service.

Awaiting mosquitto to start. This may take up to 5 seconds.

Enabling mosquitto service on reboots.

Successfully created bridge connection!

Sending packets to check connection. This may take up to 2 seconds.

ERROR: Local MQTT publish has timed out.
Warning: Bridge has been configured, but Cumulocity connection check failed.

Checking if tedge-mapper is installed.

Starting tedge-mapper-c8y service.

Persisting tedge-mapper-c8y on reboot.

tedge-mapper-c8y service successfully started and enabled!

Enabling software management.

Checking if tedge-agent is installed.

Starting tedge-agent service.

Persisting tedge-agent on reboot.

tedge-agent service successfully started and enabled!
</code></pre>
<p>This warning may be caused by some of the following reasons:</p>
<ul>
<li>No access to Internet connection</li>
</ul>
<p>Local bridge has been configured and is running but the connection check has failed due to no access to the northbound endpoint.</p>
<ul>
<li>Cumulocity tenant not available</li>
</ul>
<p>Tenant couldn't be reached and therefore connection check has failed.</p>
<ul>
<li>Check bridge</li>
</ul>
<p>Bridge configuration is correct but the connection couldn't be established to unknown reason.</p>
<p>To retry start with <a href="../../references/tedge-disconnect.html"><code>tedge disconnect c8y</code></a> removing this bridge:</p>
<pre><code class="language-shell">sudo tedge disconnect c8y
</code></pre>
<p>When this is done, issue <a href="../../references/tedge-connect.html"><code>tedge connect c8y</code></a> again.</p>
<h4 id="file-permissions"><a class="header" href="#file-permissions">File permissions</a></h4>
<p>Sample output:</p>
<pre><code class="language-shell">tedge connect c8y
</code></pre>
<pre><code>Checking if systemd is available.

Checking if configuration for requested bridge already exists.

Validating the bridge certificates.

Saving configuration for requested bridge.

Error: failed to create bridge to connect Cumulocity cloud.

Caused by:
    0: File Error. Check permissions for /etc/tedge/mosquitto-conf/tedge-mosquitto.conf.
    1: failed to persist temporary file: Permission denied (os error 13)
    2: Permission denied (os error 13)
</code></pre>
<p>tedge connect cannot access location to create the bridge configuration (<code>/etc/tedge/mosquitto-conf</code>), check permissions for the directory and adjust it to allow the tedge connect to access it.</p>
<p>Example of incorrect permissions:</p>
<pre><code class="language-shell">ls -l /etc/tedge
</code></pre>
<pre><code>dr--r--r-- 2 tedge     tedge     4096 Mar 30 15:40 mosquitto-conf
</code></pre>
<p>You should give it the permission 755.</p>
<pre><code class="language-shell">ls -l /etc/tedge
</code></pre>
<pre><code>drwxr-xr-x 2 tedge     tedge     4096 Mar 30 15:40 mosquitto-conf
</code></pre>
<h4 id="mosquitto-and-systemd-check-fails"><a class="header" href="#mosquitto-and-systemd-check-fails">mosquitto and systemd check fails</a></h4>
<p>Sample output:</p>
<pre><code class="language-shell">sudo tedge connect c8y
</code></pre>
<pre><code>Checking if systemd is available.

Checking if configuration for requested bridge already exists.

Validating the bridge certificates.

Saving configuration for requested bridge.

Restarting mosquitto service.

Error: failed to create bridge to connect Cumulocity cloud.

Caused by:
    Service mosquitto not found. Install mosquitto to use this command.
</code></pre>
<p>mosquitto server has not been installed on the system and it is required to run this command, refer to <a href="../installation/installation.html">How to install thin-edge.io?</a> to install mosquitto and try again.</p>
<h2 id="next-steps"><a class="header" href="#next-steps">Next steps</a></h2>
<ol>
<li><a href="../telemetry/pub_sub.html">How to use mqtt pub/sub?</a></li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../operate/connection/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../operate/telemetry/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../operate/connection/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../operate/telemetry/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script>
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>
        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>
        <script src="../../theme/pagetoc.js"></script>
    </div>
    </body>
</html>
